<?php
//Copyright (c) 2016 iFeiwu.com
 class Finder extends Ifeiwu { private $root = "\x64\141\x74\x61\57\146\151\x6e\x64\x65\162\57"; function __construct() { goto I1qyD; wzf2h: parent::__construct(); goto m6GJD; qoLEO: vxio2: goto wzf2h; Nfv3Z: $this->table = "\146\151\x6e\144\x65\162"; goto qoLEO; I1qyD: if ($this->table) { goto vxio2; } goto Nfv3Z; m6GJD: } protected function postAll($pid, $request_data) { goto KD2Ri; XyCV0: $level = $this->db->select($this->table, "\x6c\145\x76\x65\154")->where(array("\x69\x64", "\x3d", $pid))->get(0); goto Mo9yX; tFk29: return array("\146\x69\x6c\x65\163" => $files, "\x70\x61\x74\150\x73" => $paths); goto FxAGz; fNQcO: if (!$pid) { goto ZI7Fa; } goto XyCV0; QQ_aj: ZI7Fa: goto tFk29; Mo9yX: $level = array_filter(explode("\54", $level)); goto KS36t; JlFir: $paths = array(); goto fNQcO; KD2Ri: $files = $this->db->select($this->table)->where($request_data["\167\150\145\x72\145"])->order($request_data["\157\162\x64\145\x72"])->all(); goto JlFir; KS36t: $paths = $this->db->select($this->table, array("\151\144", "\156\x61\155\x65"))->where(array("\151\144", "\111\116", $level), "\x41\x4e\x44", array("\x74\171\160\145", "\x3d", "\x66\x6f\x6c\144\145\162"))->all(); goto QQ_aj; FxAGz: } protected function postAdd($request_data) { goto vFycF; pHiFM: return $this->success(); goto Px32G; wOlku: $data["\x6e\x61\155\145"] = $name; goto uU6IA; smVIw: $data["\160\x69\x64"] = $foid ? $foid : 0; goto vpa6j; a5lC0: $this->db->rollBack(); goto J2FZ5; RZROQ: if (!(stripos($type, "\151\x6d\141\x67\x65") !== false && is_file($filename))) { goto U6OkI; } goto EN5zM; Px32G: RDfhS: goto a5lC0; PQcSo: unlink($filename); goto pTyZH; ck9Zf: $data["\143\164\x69\x6d\x65"] = time(); goto IUTE_; MVDp6: $this->db->commit(); goto pHiFM; oCliF: if ($id = $this->db->insert($this->table, $data)->id()) { goto EcNmN; } goto PQcSo; iVkG5: if (mkdir($this->_UTF82GBK("\x2e\x2e\57" . $path), 511, true)) { goto D7105; } goto Hcb0A; pTyZH: $this->db->rollBack(); goto Af9JG; uU6IA: $data["\x74\x79\160\x65"] = $type; goto smVIw; KiLtO: U6OkI: goto D7Ugy; D7Ugy: $data["\160\141\x74\x68"] = $path; goto wOlku; mUCNc: $name = $request_data["\156\141\155\145"]; goto tk3Ap; E0ULF: Osi5F: goto vnrXq; k8fv8: $data["\150\x65\151\147\150\164"] = $imagesize[1]; goto KiLtO; J2FZ5: return $this->error("\xe4\270\x8a\xe4\xbc\240\xe6\226\207\344\273\xb6\x20" . $name . "\x20\345\xa4\261\350\264\xa5\xef\xbc\x81"); goto CAttf; IUTE_: $data["\145\x78\x74"] = end(explode("\x2e", $name)); goto XY9uS; vpa6j: $data["\163\151\x7a\145"] = $request_data["\163\151\172\x65"]; goto ck9Zf; Xag4M: if (is_dir($this->_UTF82GBK("\x2e\56\x2f" . $path))) { goto Osi5F; } goto iVkG5; naFQu: D7105: goto E0ULF; XY9uS: $this->db->beginTransaction(); goto oCliF; PE0q6: $foid = $request_data["\x66\x6f\151\144"]; goto Xag4M; xDiM4: $data["\x77\x69\x64\164\150"] = $imagesize[0]; goto k8fv8; EN5zM: $imagesize = getimagesize($filename); goto xDiM4; vFycF: $path = $request_data["\160\x61\x74\150"]; goto mUCNc; vnrXq: $filename = $this->_UTF82GBK("\x2e\56\57" . $path . $name); goto RZROQ; Hcb0A: return $this->error("\xe5\210\x9b\345\xbb\xba\346\x96\207\344\xbb\266\345\244\xb9\345\xa4\261\xe8\264\xa5\357\274\201"); goto naFQu; tk3Ap: $type = mime_content_type("\x2e\56\x2f" . $path . $name); goto PE0q6; JARM_: if (!$this->db->update($this->table, array("\x6c\145\x76\x65\154" => $level), array("\x69\x64", "\x3d", $id))->is()) { goto RDfhS; } goto MVDp6; Af9JG: return $this->error("\344\xb8\x8a\xe4\274\xa0\xe6\x96\207\344\273\266\x20" . $name . "\40\345\xa4\261\350\264\xa5\357\274\x81"); goto Q_qpZ; eCbC8: $level = $this->_getLevel($id); goto JARM_; Q_qpZ: EcNmN: goto eCbC8; CAttf: } protected function postMkdir($request_data) { goto KCIsO; d42Bt: if (!($name === null || $name === '')) { goto x4m3z; } goto G84ZI; aG3je: goto z6uC8; goto Qy0pO; U4icS: return $this->success(); goto Xybff; yPHyh: return $this->error("\345\210\x9b\345\273\xba\346\x96\207\xe4\273\xb6\345\xa4\271\345\244\261\350\264\xa5\357\xbc\x81"); goto dzuS2; n_n6F: $this->db->commit(); goto U4icS; OLK5K: x4m3z: goto rSAPE; G84ZI: return $this->error("\346\227\240\xe6\225\210\xe7\232\204\345\217\202\xe6\225\xb0\xef\xbc\x81"); goto OLK5K; yqZQt: $level = $this->_getLevel($id); goto NG6tQ; osdA4: jBeam: goto CgmyP; gBjV8: rmdir($dirname); goto YSbS3; Xybff: z6uC8: goto nEpN0; Sk5wJ: if (mkdir($dirname, 493, true)) { goto jBeam; } goto el1Nz; W9R9V: $data["\x70\x61\164\150"] = $this->root . $folder_path; goto fu8nN; kR6Ny: YGd0T: goto Sk5wJ; Ebw1b: if (!is_dir($dirname)) { goto YGd0T; } goto L4xmH; rsqRx: $data["\x74\x79\x70\x65"] = "\x66\x6f\154\144\x65\x72"; goto TOaEq; TOaEq: $data["\143\x74\x69\x6d\145"] = time(); goto lQKRV; FpiTe: $level = $this->db->select($this->table, "\140\154\x65\166\145\x6c\140")->where(array("\x69\144", "\75", $pid))->get(0); goto FzfQl; u9DOr: VFr3s: goto HmEFt; XBcAd: rmdir($dirname); goto rGCGc; F9ap9: $dirname = $this->_UTF82GBK("\56\x2e\57" . $this->root . $folder_path . $name); goto Ebw1b; YSbS3: $this->db->rollBack(); goto yPHyh; lQKRV: if ($id = $this->db->insert($this->table, $data)->id()) { goto tm_r2; } goto gBjV8; CgmyP: $this->db->beginTransaction(); goto W9R9V; A9WXt: $folder = $this->db->select($this->table, "\140\156\x61\x6d\145\140")->where(array("\151\x64", "\111\x4e", $level), "\x41\116\104", array("\x74\x79\160\145", "\x3d", "\146\157\154\144\145\162"))->all(); goto rr2he; NG6tQ: if ($this->db->update($this->table, array("\x6c\145\166\145\x6c" => $level), array("\x69\x64", "\75", $id))->is()) { goto D2WYB; } goto XBcAd; HmEFt: suapb: goto F9ap9; rSAPE: $data = array(); goto Rpb6o; Rpb6o: $data["\x6e\x61\x6d\145"] = $name; goto KSKTX; L4xmH: return $this->error($name . "\x20\346\226\x87\344\273\xb6\345\244\271\345\xb7\xb2\xe5\xad\x98\345\234\xa8\xef\xbc\x81"); goto kR6Ny; Qy0pO: D2WYB: goto n_n6F; KSKTX: $data["\x70\151\x64"] = $pid; goto HHL5t; QyCaW: $level = array_filter(explode("\54", $level)); goto A9WXt; rr2he: foreach ($folder as $value) { $folder_path .= $value["\156\x61\155\x65"] . "\57"; Vpr3k: } goto u9DOr; fu8nN: $data["\x73\x6f\162\x74\x62\x79"] = 1; goto rsqRx; rGCGc: $this->db->rollBack(); goto QcJTU; Gha1d: $name = $request_data["\156\141\155\x65"]; goto d42Bt; el1Nz: return $this->error("\345\210\233\xe5\273\xba\346\226\x87\xe4\273\266\345\xa4\xb9\xe5\244\261\350\264\xa5\357\274\x81"); goto osdA4; HHL5t: $folder_path = ''; goto FpiTe; FzfQl: if (!$level) { goto suapb; } goto QyCaW; KCIsO: $pid = $request_data["\x70\151\144"]; goto Gha1d; dzuS2: tm_r2: goto yqZQt; QcJTU: return $this->error("\xe5\210\x9b\xe5\273\272\xe6\226\207\xe4\273\266\xe5\244\xb9\xe5\244\xb1\xe8\xb4\xa5\xef\xbc\201"); goto aG3je; nEpN0: } protected function postRename($request_data) { goto KiwkF; ApI01: O5pbQ: goto wlU3M; NgHjm: goto xnd2y; goto qYVSa; K8hP8: $this->db->rollBack(); goto S0F2p; iRu8C: $this->db->rollBack(); goto ZYlLH; ChvLt: $this->db->rollBack(); goto t_DPQ; aZVWB: if ($this->db->update($this->table, array("\156\x61\155\x65" => $name), array("\x69\x64", "\x3d", $id))->is()) { goto U5LdD; } goto K8hP8; KiwkF: $id = $request_data["\151\x64"]; goto GeiLM; r_71A: SnuLg: goto dWmok; S0F2p: return $this->error("\xe6\226\x87\xe4\xbb\266\xe5\244\271\351\x87\x8d\345\221\275\345\x90\215\xe5\xa4\xb1\350\xb4\xa5\357\274\201"); goto L8nsD; ImyGs: $this->db->rollBack(); goto DQWAN; AxcOn: return $this->success(); goto ApI01; xoMwu: goto uUCI_; goto Q9mlR; wlU3M: pxbMT: goto Z4Di1; g_QwR: $oldname = $this->_UTF82GBK("\x2e\56\57" . $path . $finder["\x6e\x61\155\x65"]); goto Y4HJ2; GeiLM: $name = $request_data["\x6e\x61\155\x65"]; goto R6mRx; v1x7d: if (is_file($oldname)) { goto SnuLg; } goto GlwRL; Y4HJ2: $newname = $this->_UTF82GBK("\56\x2e\x2f" . $path . $name); goto oZFrY; zShr2: hJxYM: goto rCE3v; KLE20: return $this->error("\346\x96\207\344\xbb\xb6\xe9\207\215\xe5\221\xbd\xe5\x90\x8d\xe5\244\xb1\350\264\245\xef\274\201"); goto aDkRc; L8nsD: goto caObq; goto cuuEv; CLw7k: return $this->error("\346\227\xa0\346\225\210\xe7\x9a\204\xe8\267\257\345\276\x84\xef\xbc\x81"); goto Wv39u; j_iWa: ZN02g: goto a_PRz; wc901: $path = $finder["\x70\141\x74\150"]; goto ldVQu; DTzO_: if ($is_path_update !== false) { goto MTcrX; } goto ENTL5; wpq7n: uUCI_: goto MhzO1; Z4Di1: goto KoBFD; goto E_0ab; dWmok: if ($this->db->update($this->table, array("\156\x61\x6d\145" => $name), array("\x69\x64", "\75", $id))->is()) { goto ZN02g; } goto bujed; aAwZR: $sublist = $this->db->select($this->table, array("\151\144", "\154\x65\x76\145\x6c", "\x74\x79\160\145"))->where(array("\154\145\166\x65\154", "\114\111\113\x45", "\45\54{$id}\54\45"))->all(); goto PTqlM; E_0ab: owm3c: goto aZVWB; vhBAN: return $this->success(); goto b3FF7; xL1Ke: KU6jr: goto DTzO_; Q3hUO: return $this->error("\xe6\211\xbe\344\xb8\x8d\345\x88\260\351\x87\215\xe5\221\275\xe5\220\x8d\xe7\232\x84\346\x96\x87\344\273\xb6\57\346\x96\207\xe4\273\xb6\345\244\xb9\357\xbc\x81"); goto Xwmy5; wL8aH: DHcQM: goto RG12q; oZFrY: $this->db->beginTransaction(); goto v1x7d; b3FF7: xnd2y: goto wpq7n; hnVQZ: KoBFD: goto QYJgp; MhzO1: caObq: goto hnVQZ; INLfk: return $this->error("\xe6\227\xa0\346\x95\210\xe7\x9a\x84\xe5\x8f\x82\xe6\x95\xb0\357\xbc\x81"); goto zShr2; bUehf: $this->db->commit(); goto vhBAN; PTqlM: foreach ($sublist as $sub) { goto WGouC; WGouC: if (!($sub["\154\x65\166\145\x6c"] == $finder["\154\x65\166\145\154"])) { goto sHzxL; } goto Tz9CT; V73ca: $is_path_update = $this->db->update($this->table, array("\x70\x61\x74\x68" => $this->root . $newpath), array("\151\x64", "\75", $sub["\151\x64"]))->is(); goto pNjHv; Tz9CT: goto xsI0A; goto RSVLF; pNjHv: if (!($is_path_update === false)) { goto R1q_h; } goto nS2aT; vpb08: R1q_h: goto RpCKf; RSVLF: sHzxL: goto Rd_pp; Rd_pp: $newpath = ''; goto tYDS8; tYDS8: $level = array_filter(explode("\54", $sub["\x6c\x65\166\x65\154"])); goto Wk11T; RpCKf: xsI0A: goto DrmFT; nS2aT: goto KU6jr; goto vpb08; GMULY: S0UYO: goto V73ca; Wk11T: foreach ($level as $lid) { goto A8E9b; fhRPm: goto gkTMM; goto yBscI; QYHiI: if (!($sub["\164\x79\x70\145"] == "\146\x6f\x6c\144\x65\x72" && $sub["\x6c\145\166\145\154"] == $levelobj["\x6c\145\x76\145\154"])) { goto DV0jW; } goto fhRPm; Tj5_y: $level_name = $levelobj["\x6e\141\x6d\x65"]; goto pjXHh; vo21M: gkTMM: goto hekN8; A8E9b: $levelobj = $this->db->select($this->table, array("\x6e\141\x6d\145", "\x6c\145\166\145\x6c"))->where("\x69\x64\40\x3d\40{$lid}\x20\101\x4e\x44\x20\x74\x79\x70\x65\40\75\x20\47\x66\157\x6c\x64\x65\x72\x27")->get(); goto QYHiI; pjXHh: $newpath .= $level_name != '' ? $level_name . "\x2f" : ''; goto vo21M; yBscI: DV0jW: goto Tj5_y; hekN8: } goto GMULY; DrmFT: } goto xL1Ke; rCE3v: $finder = $this->db->select($this->table, array("\x70\141\164\x68", "\156\141\155\x65", "\x6c\x65\x76\145\x6c"))->where(array("\151\144", "\x3d", $id))->get(); goto wc901; aDkRc: goto pxbMT; goto j_iWa; ltpWC: goto O5pbQ; goto wL8aH; ZYlLH: return $this->error("\xe6\x96\207\xe4\273\xb6\xe5\xa4\271\xe9\x87\x8d\345\x91\275\xe5\x90\x8d\xe5\244\261\350\xb4\xa5\xef\274\x81"); goto NgHjm; R6mRx: if (!(!$id || $name === null || $name === '')) { goto hJxYM; } goto INLfk; EmoIg: if (rename($oldname, $newname)) { goto YkBBo; } goto ChvLt; bujed: $this->db->rollBack(); goto KLE20; DQWAN: return $this->error("\xe6\226\x87\xe4\273\266\xe9\207\x8d\345\x91\xbd\xe5\x90\215\345\xa4\xb1\xe8\xb4\xa5\xef\xbc\x81"); goto ltpWC; t_DPQ: return $this->error($name . "\40\xe6\226\207\xe4\273\xb6\xe5\244\xb9\xe5\xb7\262\xe5\255\230\345\234\250\357\274\201"); goto xoMwu; ldVQu: if (!(!$path || stripos($path, $this->root) === false)) { goto kyheM; } goto CLw7k; Q9mlR: YkBBo: goto aAwZR; Xwmy5: goto KoBFD; goto r_71A; ENTL5: rename($newname, $oldname); goto iRu8C; Wv39u: kyheM: goto g_QwR; a_PRz: if (rename($oldname, $newname)) { goto DHcQM; } goto ImyGs; GlwRL: if (is_dir($oldname)) { goto owm3c; } goto Q3hUO; cuuEv: U5LdD: goto EmoIg; qYVSa: MTcrX: goto bUehf; RG12q: $this->db->commit(); goto AxcOn; QYJgp: } protected function postIsFile($request_data) { goto QMrfN; QMrfN: $path = $request_data["\160\141\x74\x68"]; goto upDLY; WDsIg: RYMH9: goto mJcKZ; T6vIU: return $this->error($name . "\x20\346\x96\207\344\xbb\266\344\270\215\345\xad\230\345\234\250\357\xbc\x81"); goto aNcNz; FFUH5: if (file_exists($this->_UTF82GBK("\56\x2e\x2f" . $path . $name))) { goto hJgHW; } goto T6vIU; aNcNz: goto RYMH9; goto KjUkv; KjUkv: hJgHW: goto tGYrf; upDLY: $name = $request_data["\156\141\x6d\x65"]; goto FFUH5; tGYrf: return $this->success($name . "\x20\346\x96\x87\xe4\xbb\266\xe5\xb7\xb2\345\255\x98\xe5\234\250\357\274\x81"); goto WDsIg; mJcKZ: } protected function postDelete($request_data) { goto uQ0vO; ab8Oq: Jx2RD: goto VnHLG; DREmR: foreach ($ids as $id) { goto Ai7Lz; kqrlq: TZDI2: goto mo8Zq; Fv872: mjzE4: goto kCzql; W7j3x: X0FUR: goto FRsh8; Gwg7E: if (is_dir($filename)) { goto V3orL; } goto SIoE6; zhExm: goto OGks_; goto kqrlq; RM83G: goto OGks_; goto WSPIQ; RDrnY: if (is_file($filename)) { goto Gbry1; } goto Gwg7E; Duggz: @unlink($filename); goto W7j3x; WSPIQ: ONvIF: goto STCrH; g5aQd: if (!(!$path || stripos($path, "\x64\x61\x74\x61\57\x66\151\156\144\145\x72\x2f") === false || $name == null || $name == '')) { goto ONvIF; } goto hPWb9; sKATr: OGks_: goto zHQLT; IY33x: V3orL: goto ZRdWO; Ai7Lz: $file = $this->db->select($this->table, array("\x70\141\164\150", "\156\x61\x6d\x65"))->where(array("\151\x64", "\x3d", $id))->get(); goto IYf0a; GvBNz: if (!$this->db->delete($this->table, array("\151\x64", "\x3d", $id))->is()) { goto X0FUR; } goto Duggz; SIoE6: $this->db->delete($this->table, array("\x6c\x65\166\145\154", "\114\x49\x4b\105", "\x25\x2c{$id}\x2c\45")); goto KjgaL; pufQQ: $this->_rmdir($filename); goto Fv872; FRsh8: goto GPUcV; goto IY33x; STCrH: $filename = $this->_UTF82GBK("\x2e\56\57" . $path . $name); goto RDrnY; mo8Zq: $path = $file["\x70\141\x74\150"]; goto t70zi; hPWb9: $this->db->delete($this->table, array("\151\x64", "\x3d", $id))->is(); goto RM83G; t70zi: $name = $file["\x6e\141\155\145"]; goto g5aQd; KjgaL: goto GPUcV; goto SIsox; IYf0a: if ($file) { goto TZDI2; } goto zhExm; kCzql: GPUcV: goto sKATr; SIsox: Gbry1: goto GvBNz; ZRdWO: if (!$this->db->delete($this->table, array("\154\x65\x76\145\154", "\114\111\113\105", "\45\54{$id}\54\45"))->is()) { goto mjzE4; } goto pufQQ; zHQLT: } goto ab8Oq; VnHLG: return $this->success(); goto hmgD3; uQ0vO: $ids = $request_data["\151\144"]; goto DREmR; hmgD3: } protected function getCurPath($foid) { goto mFAUY; mFAUY: $level = $this->db->select($this->table, "\154\x65\x76\145\154")->where(array("\x69\144", "\75", $foid))->get(0); goto r00Fa; eofEQ: $data = $this->db->select($this->table, array("\151\144", "\156\x61\x6d\145"))->where(array(array("\x69\144", "\x49\116", $level), "\x41\x4e\104", array("\164\x79\160\145", "\x3d", "\x66\x6f\154\x64\x65\162")))->all(); goto eRE2Q; eRE2Q: return $this->success('', $data); goto KBSLM; r00Fa: $level = array_filter(explode("\x2c", $level)); goto eofEQ; KBSLM: } }
